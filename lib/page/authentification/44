class ChatService extends ChangeNotifier { // get instance of auth and firestore
Final FirebaseAuth firebaseAuth FirebaseAuth. instance;
final Firebasefirestore fireStore Firebasefirestore. instance;
// SEND MESSAGE
Future void> sendMessage(String receiverid, String message) async // get current user info
final String currentUserId = firebaseAuth.currentUser!.uid;
final String currentUserEmail firebaseAuth.currentUser!.email.toString(); final Timestamp timestamp Timestamp.now();
// create a new message
Message newMessage = Message senderId: currentUserId,
senderEmail: currentUserEmail,
receiverid: receiverId,
timestamp: timestamp,
message: message,
// construct chat room id from current user id and receiver id (sorted to ensure uns
List<Strings ids = [currentUserId, receiverId);
ids.sort(); //sort the ids (this ensures the chat room id is always the same for an String chatRoomId ids.join(""); // combine the ids into a single string to use a
// add new message to database
// GET MESSAGES